<% u = URI(database_url) -%>
setup: &setup
  adapter: "<%= u.scheme %>"
  host: "<%= u.host || "localhost" %>"
  username: "<%= u.user || title %>"
  password: "<%= u.password || title %>"
  <% (u.query || "").split("&").each do |k| -%>
  <% p = k.split("=") -%>
  <%= p[0] %>: "<%= p[1] %>"
  <% end -%>

<%= env %>:
  database: "<%= s = u.path.to_s[1..-1]; s == "" ? "#{title.gsub('-', '_')}_#{env}" : s %>"
  <<: *setup
